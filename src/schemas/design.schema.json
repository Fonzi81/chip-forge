{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ChipForge Design Schema",
  "description": "Schema for ChipForge schematic design files",
  "type": "object",
  "required": ["id", "meta", "components", "nets", "buses", "constraints", "docs"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^cf_[a-zA-Z0-9_-]+$",
      "description": "Unique design identifier"
    },
    "meta": {
      "type": "object",
      "required": ["name", "version", "created", "modified"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Design name"
        },
        "description": {
          "type": "string",
          "description": "Optional design description"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version"
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp"
        },
        "modified": {
          "type": "string",
          "format": "date-time",
          "description": "Last modification timestamp"
        },
        "author": {
          "type": "string",
          "description": "Design author"
        }
      }
    },
    "components": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/component"
      },
      "minItems": 1,
      "description": "Array of design components"
    },
    "nets": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/net"
      },
      "description": "Array of signal nets"
    },
    "buses": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/bus"
      },
      "description": "Array of bus definitions"
    },
    "constraints": {
      "type": "object",
      "required": ["clocks", "resets"],
      "properties": {
        "clocks": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/clock"
          },
          "minItems": 1,
          "description": "Clock constraints"
        },
        "resets": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/reset"
          },
          "minItems": 1,
          "description": "Reset constraints"
        },
        "timing": {
          "type": "object",
          "description": "Timing constraints"
        },
        "parity": {
          "type": "object",
          "description": "Parity constraints"
        }
      }
    },
    "docs": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/docRef"
      },
      "description": "Documentation references"
    }
  },
  "definitions": {
    "component": {
      "type": "object",
      "required": ["id", "name", "type", "pins", "params", "view"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^cf_[a-zA-Z0-9_-]+$"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "minLength": 1
        },
        "pins": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/pin"
          },
          "minItems": 1
        },
        "params": {
          "type": "object",
          "additionalProperties": {
            "oneOf": [
              {"type": "number"},
              {"type": "string"},
              {"type": "boolean"}
            ]
          }
        },
        "view": {
          "type": "object",
          "required": ["icon2d"],
          "properties": {
            "icon2d": {
              "type": "string"
            },
            "model3d": {
              "type": "string"
            }
          }
        },
        "compliance": {
          "$ref": "#/definitions/compliance"
        }
      }
    },
    "pin": {
      "type": "object",
      "required": ["id", "name", "dir", "width"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "dir": {
          "type": "string",
          "enum": ["in", "out", "inout"]
        },
        "width": {
          "type": "integer",
          "minimum": 1
        },
        "netId": {
          "type": "string"
        },
        "busRole": {
          "type": "string",
          "enum": ["manager", "subordinate", "decoder", "mux"]
        }
      }
    },
    "net": {
      "type": "object",
      "required": ["id", "name", "width", "endpoints"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^cf_[a-zA-Z0-9_-]+$"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "width": {
          "type": "integer",
          "minimum": 1
        },
        "endpoints": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["componentId", "pinId"],
            "properties": {
              "componentId": {
                "type": "string"
              },
              "pinId": {
                "type": "string"
              }
            }
          },
          "minItems": 2
        }
      }
    },
    "bus": {
      "type": "object",
      "required": ["id", "kind", "signals", "properties"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^cf_[a-zA-Z0-9_-]+$"
        },
        "kind": {
          "type": "string",
          "enum": ["AHB", "AXI", "APB", "Custom"]
        },
        "signals": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/netRef"
          }
        },
        "properties": {
          "type": "object"
        }
      }
    },
    "netRef": {
      "type": "object",
      "required": ["netId", "role", "direction"],
      "properties": {
        "netId": {
          "type": "string"
        },
        "role": {
          "type": "string"
        },
        "direction": {
          "type": "string",
          "enum": ["master", "slave"]
        }
      }
    },
    "clock": {
      "type": "object",
      "required": ["name", "freqMHz"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "freqMHz": {
          "type": "number",
          "minimum": 0.001
        },
        "stableBetweenClock": {
          "type": "boolean"
        }
      }
    },
    "reset": {
      "type": "object",
      "required": ["name", "active", "syncDeassert"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "active": {
          "type": "string",
          "enum": ["low", "high"]
        },
        "syncDeassert": {
          "type": "boolean"
        }
      }
    },
    "compliance": {
      "type": "object",
      "required": ["standard"],
      "properties": {
        "standard": {
          "type": "string",
          "enum": ["AHB", "AXI", "None"]
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "docRef": {
      "type": "object",
      "required": ["id", "type"],
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["datasheet", "specification", "user_guide", "other"]
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "content": {
          "type": "string"
        },
        "version": {
          "type": "string"
        }
      }
    }
  }
} 